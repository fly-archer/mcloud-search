(self["webpackChunkmcloud_search"]=self["webpackChunkmcloud_search"]||[]).push([[872],{12872:function(t,e,s){"use strict";s.r(e),s.d(e,{default:function(){return c}});var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t.isInternalBrowser?s("van-nav-bar",{attrs:{title:"数据展示","left-arrow":""},on:{"click-left":t.onClickLeft}}):t._e(),s("div",{staticClass:"app-container"},[s("div",{staticClass:"auto-resfresh"},[s("a-switch",{attrs:{"checked-children":"自动刷新","un-checked-children":"自动刷新"},on:{change:t.onSwitchChange},model:{value:t.isRun,callback:function(e){t.isRun=e},expression:"isRun"}}),s("div",{staticClass:"copy-url",on:{click:t.onCopyUrl}},[s("van-icon",{attrs:{color:"#1890ff",name:"records"}}),s("span",[t._v("复制链接")])],1)],1),s("van-row",[s("van-col",{attrs:{span:"12"}},[t._v("设备SN: "+t._s(t.params.sn))]),s("van-col",{attrs:{span:"12"}},[t._v(" 数据范围: "+t._s(t.formatDataType())+" ")])],1),s("van-row",[s("van-col",[t._v(" 时间范围:"+t._s(t.params.begin+"~"+t.params.end)+" ")])],1),s("van-row",[s("van-col",[t._v(" 内容过滤: "+t._s(t.params.filterValue||"---")+" ")])],1),s("van-row",[s("van-col",[t._v(" 数据总数: "+t._s("iot"==t.active?t.iotTotalCount+" (已加载"+t.iotResultList.length+"条)":t.mdnetTotalCount+" (已加载"+t.mdnetResultList.length+"条)")+" ")])],1),s("van-row",{ref:"tabsContainer"},[s("van-tabs",{attrs:{sticky:!0,color:"#1890ff",animated:"",swipeable:""},model:{value:t.active,callback:function(e){t.active=e},expression:"active"}},["0"==t.params.iotData||"1"==t.params.iotData?s("van-tab",{attrs:{title:"物联网平台",name:"iot"}},[s("van-pull-refresh",{on:{refresh:t.onRefresh},model:{value:t.iotRefreshing,callback:function(e){t.iotRefreshing=e},expression:"iotRefreshing"}},[t.iotFinished&&0==t.iotResultList.length?s("van-empty",{attrs:{description:"暂无数据"}}):t._e(),s("van-list",{attrs:{finished:t.iotFinished,error:t.iotError,"error-text":"请求失败，点击重新加载","finished-text":t.iotResultList.length>0?"没有更多了":""},on:{"update:error":function(e){t.iotError=e},load:t.onIotLoad},model:{value:t.iotLoading,callback:function(e){t.iotLoading=e},expression:"iotLoading"}},t._l(t.iotResultList,(function(e,n){return s("van-cell",{key:n,attrs:{center:"","is-link":""},on:{click:function(s){return t.onCellClick(e)}},scopedSlots:t._u([{key:"title",fn:function(){return[s("div",{staticClass:"custom-title"},[s("span",{staticClass:"num"},[t._v(t._s(n+1))]),s("span",{staticClass:"title"},[t._v(" "+t._s(e.content.replace(/\s*/g,""))+" ")])])]},proxy:!0},{key:"label",fn:function(){return[s("div",{staticClass:"custom-label"},[s("span",[t._v(t._s(e.timeStr))]),s("span",[t._v("数据类型 "+t._s(e.dataType))])])]},proxy:!0}],null,!0)})})),1)],1)],1):t._e(),"0"==t.params.iotData||"2"==t.params.iotData?s("van-tab",{attrs:{name:"mdnet",title:"MDNET平台"}},[s("van-pull-refresh",{on:{refresh:t.onRefresh},model:{value:t.mdnetRefreshing,callback:function(e){t.mdnetRefreshing=e},expression:"mdnetRefreshing"}},[t.mdnetFinished&&0==t.mdnetResultList.length?s("van-empty",{attrs:{description:"暂无数据"}}):t._e(),s("van-list",{attrs:{finished:t.mdnetFinished,error:t.mdnetError,"error-text":"请求失败，点击重新加载","finished-text":t.mdnetResultList.length>0?"没有更多了":""},on:{"update:error":function(e){t.mdnetError=e},load:t.onMdnetLoad},model:{value:t.mdnetLoading,callback:function(e){t.mdnetLoading=e},expression:"mdnetLoading"}},t._l(t.mdnetResultList,(function(e,n){return s("van-cell",{key:n,attrs:{center:"","is-link":""},on:{click:function(s){return t.onCellClick(e)}},scopedSlots:t._u([{key:"title",fn:function(){return[s("div",{staticClass:"custom-title"},[s("span",{staticClass:"num"},[t._v(t._s(n+1))]),s("span",{staticClass:"title"},[t._v(" "+t._s(e.content.replace(/\s*/g,""))+" ")])])]},proxy:!0},{key:"label",fn:function(){return[s("div",{staticClass:"custom-label"},[s("span",[t._v(t._s(e.timeStr))]),s("span",[t._v("数据类型 "+t._s(e.dataType))])])]},proxy:!0}],null,!0)})})),1)],1)],1):t._e()],1)],1)],1)],1)},i=[],a=(s(33948),s(79663)),r={name:"MobileDetail",data(){return{value:"",show:!1,active:"",params:{},searchRecords:this.$ls.get("searchRecords")||[],isInternalBrowser:this.$ls.get("isInternalBrowser"),time:null,timerRun:null,isRun:!1,tabsContainer:null,resultListLength:0,iotTotalCount:"",iotResultList:[],iotCurrentPage:1,iotLoading:!1,iotFinished:!1,iotRefreshing:!1,iotError:!1,mdnetTotalCount:"",mdnetResultList:[],mdnetCurrentPage:1,mdnetLoading:!1,mdnetFinished:!1,mdnetRefreshing:!1,mdnetError:!1}},mounted(){this.tabsContainer=this.$refs.tabsContainer,this.params=Object.assign({},this.params,this.$route.query)},methods:{onClickLeft(){this.$router.push("/mobile/home")},onIotLoad(){let t=Object.assign({},this.params,{currentPage:this.iotCurrentPage,pageSize:20,iotData:!0});delete t.fastTime,(0,a.A)(t).then((e=>{e.success?(this.iotTotalCount=e.data.totalCount,0!==e.data.totalCount?this.iotResultList.push(...e.data.currentPageData):this.iotFinished=!0,1==this.iotCurrentPage&&(this.searchRecords.some(((e,s)=>{e.sn===t.sn&&this.searchRecords.splice(s,1)})),this.searchRecords.length>=20&&this.searchRecords.pop(),this.searchRecords.unshift(this.params),this.$ls.set("searchRecords",this.searchRecords)),this.iotCurrentPage<e.data.totalPage?this.iotCurrentPage++:this.iotCurrentPage==e.data.totalPage&&(this.iotFinished=!0)):this.iotError=!0,this.iotRefreshing=!1,this.iotLoading=!1}))},onMdnetLoad(){let t=Object.assign({},this.params,{currentPage:this.mdnetCurrentPage,pageSize:20,iotData:!1});delete t.fastTime,(0,a.A)(t).then((e=>{e.success?(this.mdnetTotalCount=e.data.totalCount,0!==e.data.totalCount?this.mdnetResultList.push(...e.data.currentPageData):this.mdnetFinished=!0,1==this.mdnetCurrentPage&&(this.searchRecords.some(((e,s)=>{e.sn===t.sn&&this.searchRecords.splice(s,1)})),this.searchRecords.length>=20&&this.searchRecords.pop(),this.searchRecords.unshift(this.params),this.$ls.set("searchRecords",this.searchRecords)),this.mdnetCurrentPage<e.data.totalPage?this.mdnetCurrentPage++:this.mdnetCurrentPage==e.data.totalPage&&(this.mdnetFinished=!0)):this.mdnetError=!0,this.mdnetRefreshing=!1,this.mdnetLoading=!1}))},onCellClick(t){this.$router.push({name:"mobile/jsonDetail",query:t})},formatDataType(){let t;return t="0"==this.params.dataType?"传感器数据":"1"==this.params.dataType?"设备状态数据":"全部数据",t},onRefresh(){"mdnet"!=this.active?(this.iotRefreshing=!0,this.iotFinished=!1,this.iotLoading=!0,this.iotCurrentPage=1,this.iotResultList=[],this.onIotLoad()):(this.mdnetRefreshing=!0,this.mdnetFinished=!1,this.mdnetLoading=!0,this.mdnetCurrentPage=1,this.mdnetResultList=[],this.onMdnetLoad())},timerRefreshPage(){-1==this.time&&(this.time=20,this.onRefresh()),this.time--},timerEvent(){this.time=20,this.onRefresh(),this.isRun=!0,this.timerRun=setInterval(this.timerRefreshPage,1e3)},stopTimerEvent(){this.timerRun&&(clearInterval(this.timerRun),this.isRun=!1)},onCopyUrl(){let t=window.location.href,e=document.createElement("textarea");e.value=t,document.body.appendChild(e),e.select(),document.execCommand("Copy"),document.body.removeChild(e),this.$notify({type:"success",message:"复制成功"})},onSwitchChange(t){t?(this.stopTimerEvent(),this.timerEvent()):this.stopTimerEvent()}}},o=r,l=s(1001),h=(0,l.Z)(o,n,i,!1,null,"02f9fabc",null),c=h.exports},79663:function(t,e,s){"use strict";s.d(e,{A:function(){return a}});var n=s(91026),i=s(25972);async function a(t){return(0,i.WY)(n.QUERY_CLOUD_DATA,i.Yw.POST,t)}},91026:function(t){const e="https://chaxunapi.shmedo.cn";t.exports={QUERY_CLOUD_DATA:`${e}/queryCloudData`}}}]);