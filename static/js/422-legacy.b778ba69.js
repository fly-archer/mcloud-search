"use strict";(self["webpackChunkmcloud_search"]=self["webpackChunkmcloud_search"]||[]).push([[422],{41422:function(t,e,i){i.r(e),i.d(e,{default:function(){return f}});var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[t.isInternalBrowser?i("van-nav-bar",{attrs:{title:"数据查询"}}):t._e(),i("div",{staticClass:"app-container"},[i("van-search",{attrs:{"left-icon":"","show-action":"",clearable:!1,"right-icon":"",placeholder:"请输入设备SN号或GNSS名称",maxlength:"30"},on:{focus:t.onSearchFocus},scopedSlots:t._u([{key:"action",fn:function(){return[i("div",{on:{click:t.onScan}},[i("van-icon",{staticStyle:{"font-size":"23px",display:"flex"},attrs:{size:"23",name:"scan"}})],1)]},proxy:!0}]),model:{value:t.searchValue,callback:function(e){t.searchValue=e},expression:"searchValue"}}),i("div",{directives:[{name:"clickoutside",rawName:"v-clickoutside",value:t.handleSearchClose,expression:"handleSearchClose"}],staticClass:"search-panel"},[t.searchHistory.length>0&&t.searchShow?i("div",{staticClass:"panel-content"},[i("div",{staticClass:"panel-title"},[i("span",[t._v("搜索历史")]),i("span",[i("van-icon",{attrs:{name:"delete-o"},on:{click:function(e){return t.onClearAllCacheDialog("search")}}})],1)]),t._l(t.searchHistory,(function(e,a){return i("van-tag",{key:a,staticStyle:{margin:"0px 10px 10px 0px"},attrs:{round:"",size:"large",color:"#E9E9E9","text-color":"#505050"},on:{click:function(i){return t.setInputText(0,e)}}},[t._v(t._s(e))])}))],2):t._e()]),i("div",{staticClass:"cell"},[i("van-radio-group",{staticClass:"custom-radio-group",attrs:{direction:"horizontal"},on:{change:t.onFastTimeChange},model:{value:t.fastTime,callback:function(e){t.fastTime=e},expression:"fastTime"}},[i("van-radio",{attrs:{name:"1"}},[t._v("当天")]),i("van-radio",{attrs:{name:"2"}},[t._v("两天内")]),i("van-radio",{attrs:{name:"3"}},[t._v("三天内")]),i("van-radio",{attrs:{name:"4"}},[t._v("一周内")]),i("van-radio",{attrs:{name:"5"}},[t._v("自定义")])],1),i("van-row",{attrs:{type:"flex",justify:"center"}},[i("van-col",{attrs:{span:"3"}},[i("van-button",{staticStyle:{height:"88px","z-index":"1"},attrs:{type:"info",plain:""},on:{click:t.onLeftTimeBtn}},[i("van-icon",{attrs:{name:"arrow-left"}})],1)],1),i("van-col",{attrs:{span:"18"}},[i("van-field",{attrs:{readonly:"","right-icon":"calendar-o",name:"beginTimePicker",value:t.begin,label:"开始",placeholder:"点击选择时间"},on:{click:function(e){return t.onTimePicker(0)}}}),i("van-field",{attrs:{readonly:"","right-icon":"calendar-o",name:"endTimePicker",label:"结束",placeholder:"点击选择时间",value:t.end},on:{click:function(e){return t.onTimePicker(1)}}}),i("van-popup",{attrs:{position:"bottom"},model:{value:t.showPicker,callback:function(e){t.showPicker=e},expression:"showPicker"}},[i("van-datetime-picker",{attrs:{type:"datetime",title:t.datetimeTitle,"max-date":t.maxDate,value:t.currentDate},on:{confirm:function(e){t.onConfirm(t.currentPickerType,e)},cancel:function(e){t.showPicker=!1}}})],1)],1),i("van-col",{attrs:{span:"3"}},[i("van-button",{staticStyle:{height:"88px"},attrs:{plain:"",type:"info",disabled:t.rightBtnDisabled},on:{click:t.onRightTimeBtn}},[i("van-icon",{attrs:{name:"arrow"}})],1)],1)],1)],1),i("div",{staticClass:"cell"},[i("van-radio-group",{attrs:{direction:"horizontal"},model:{value:t.iotData,callback:function(e){t.iotData=e},expression:"iotData"}},[i("van-radio",{attrs:{name:"0"}},[t._v("全部")]),i("van-radio",{attrs:{name:"1"}},[t._v("物联网平台")]),i("van-radio",{attrs:{name:"2"}},[t._v("MDNET平台")])],1)],1),i("div",{staticClass:"cell"},[i("van-radio-group",{attrs:{direction:"horizontal"},model:{value:t.dataType,callback:function(e){t.dataType=e},expression:"dataType"}},[i("van-radio",{attrs:{name:""}},[t._v("全部")]),i("van-radio",{attrs:{name:"0"}},[t._v("传感器数据")]),i("van-radio",{attrs:{name:"1"}},[t._v("设备状态数据")])],1)],1),i("van-search",{attrs:{"left-icon":"","right-icon":"",maxlength:"30",clearable:!1,placeholder:"数据内容过滤，可不填写，也可以填写字符串或正则"},on:{focus:t.onFilterFocus},model:{value:t.filterValue,callback:function(e){t.filterValue=e},expression:"filterValue"}}),i("div",{directives:[{name:"clickoutside",rawName:"v-clickoutside",value:t.handleFilterClose,expression:"handleFilterClose"}],staticClass:"search-panel"},[t.filterHistory.length>0&&t.filterShow?i("div",{staticClass:"panel-content"},[i("div",{staticClass:"panel-title"},[i("span",[t._v("数据过滤历史")]),i("span",[i("van-icon",{attrs:{name:"delete-o"},on:{click:function(e){return t.onClearAllCacheDialog("filter")}}})],1)]),t._l(t.filterHistory,(function(e,a){return i("van-tag",{key:a,staticStyle:{margin:"0px 10px 10px 0px"},attrs:{round:"",size:"large",color:"#E9E9E9","text-color":"#505050"},on:{click:function(i){return t.setInputText(1,e)}}},[t._v(t._s(e))])}))],2):t._e()]),i("div",{staticClass:"cell"},[i("van-button",{attrs:{type:"info",block:""},on:{click:t.onSearch}},[t._v("立即查询")])],1),t.searchRecords.length>0?i("van-nav-bar",{attrs:{title:"查询历史"}}):t._e(),t.searchRecords.length>0?i("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多了"},on:{load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.searchRecords,(function(e,a){return i("van-cell",{key:a,attrs:{title:e.sn,"label-class":"custom-cell-label",value:t.formatCellValue(e),label:t.formatCellLabel(e)},on:{click:function(i){return t.onCellClick(e)}}})})),1):t._e()],1),i("van-popup",{staticStyle:{width:"300px","border-radius":"10px"},on:{close:t.onPopupClose},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[i("van-button",{staticStyle:{color:"#1989fa","border-width":"1px 0 0"},attrs:{block:""},on:{click:t.onQuickParams}},[t._v("应用查询历史")]),i("van-button",{staticStyle:{color:"#ee0a24","border-width":"1px 0 0"},attrs:{block:""},on:{click:t.onCurrentSearchHistroyDelete}},[t._v("删除当前查询历史")]),i("van-button",{staticStyle:{color:"#ee0a24","border-width":"1px 0 0"},attrs:{block:""},on:{click:t.onSearchHistroyAllDelete}},[t._v("删除全部查询历史")])],1)],1)},s=[],r=(i(26699),i(32023),i(41539),i(70189),i(78783),i(33948),i(91038),i(5212),i(40561),i(82772),{bind:function(t,e){function i(i){if(t.contains(i.target)||i.target.placeholder&&(-1!==i.target.placeholder.indexOf("GNSS")||-1!==i.target.placeholder.indexOf("正则")))return!1;e.expression&&e.value(i)}t.__vueClickOutside__=i,document.addEventListener("click",i)},update:function(){},unbind:function(t){document.removeEventListener("click",t.__vueClickOutside__),delete t.__vueClickOutside__}}),n=r,o=i(17133),l=i.n(o),c={name:"MobileHome",data:function(){return{show:!1,searchValue:null,filterValue:null,searchShow:!1,filterShow:!1,dataType:"",iotData:"0",maxDate:new Date,currentDate:new Date,fastTime:"3",rightBtnDisabled:!0,list:[],searchHistory:this.$ls.get("searchHistory")||[],filterHistory:this.$ls.get("filterHistory")||[],searchRecords:this.$ls.get("searchRecords")||[],isInternalBrowser:this.$ls.get("isInternalBrowser"),loading:!1,finished:!1,begin:l()().subtract(3,"days").format("YYYY-MM-DD HH:mm"),end:l()().format("YYYY-MM-DD HH:mm"),datetimeTitle:null,showPicker:!1,currentPickerType:null,currentHistroyParam:null}},mounted:function(){var t=this.$route.params;this.searchValue=t&&t.searchValue},directives:{clickoutside:n},watch:{begin:function(){var t=l()(this.end).diff(l()(this.begin),"hour");this.rightBtnDisabled=!l()(this.end).add(t,"hour").isBefore(l()())},end:function(){var t=l()(this.end).diff(l()(this.begin),"hour");this.rightBtnDisabled=!l()(this.end).add(t,"hour").isBefore(l()())}},methods:{onSearch:function(){if(!this.searchValue)return this.$notify({type:"warning",message:"请输入设备 SN 号或 GNSS 名称"}),!1;if(this.searchHistory.includes(this.searchValue)){var t=new Set(this.searchHistory);t.delete(this.searchValue),this.searchHistory=Array.from(t)}if(this.searchHistory.length>=20&&this.searchHistory.pop(),this.searchHistory.unshift(this.searchValue),this.$ls.set("searchHistory",this.searchHistory),this.filterHistory.includes(this.filterValue)){var e=new Set(this.filterHistory);e.delete(this.filterValue),this.filterHistory=Array.from(e)}this.filterHistory.length>=20&&this.filterHistory.pop(),this.filterValue&&this.filterHistory.unshift(this.filterValue),this.filterValue&&this.$ls.set("filterHistory",this.filterHistory),this.$router.push({name:"mobile/detail",query:{sn:this.searchValue,begin:this.begin+":00",end:this.end+":00",condition:this.filterValue,iotData:this.iotData,fastTime:this.fastTime,dataType:this.dataType}})},onScan:function(){this.$router.push({name:"mobile/scan"})},formatCellLabel:function(t){var e,i;return"0"==t.iotData?e="全部平台":"1"==t.iotData?e="仅物联网平台":"2"==t.iotData&&(e="仅MDNET平台"),t.dataType?"0"==t.dataType?i="传感器数据":"1"==t.dataType&&(i="设备状态数据"):i="全部数据",e+"　"+i+"　"+t.condition},formatCellValue:function(t){var e;return"1"==t.fastTime?e="当天":"2"==t.fastTime?e="两天内":"3"==t.fastTime?e="三天内":"4"==t.fastTime?e="一周内":"5"==t.fastTime&&(e="自定义"),e},onSearchFocus:function(){this.searchShow=!0,this.filterShow=!1},onFilterFocus:function(){this.filterShow=!0,this.searchShow=!1},onTimePicker:function(t){this.currentPickerType=t,0==t?(this.datetimeTitle="开始时间",this.currentDate=new Date(this.begin)):(this.datetimeTitle="结束时间",this.currentDate=new Date(this.end)),this.showPicker=!0},onLeftTimeBtn:function(){var t=l()(this.end).diff(l()(this.begin),"hour");this.begin=l()(this.begin).subtract(t,"hour").format("YYYY-MM-DD HH:mm"),this.end=l()(this.end).subtract(t,"hour").format("YYYY-MM-DD HH:mm")},onRightTimeBtn:function(){var t=l()(this.end).diff(l()(this.begin),"hour");this.begin=l()(this.begin).add(t,"hour").format("YYYY-MM-DD HH:mm"),this.end=l()(this.end).add(t,"hour").format("YYYY-MM-DD HH:mm")},handleSearchClose:function(){this.searchShow=!1},handleFilterClose:function(){this.filterShow=!1},onCellClick:function(t){this.show=!0,this.currentHistroyParam=t},onPopupClose:function(){this.show=!1,this.currentHistroyParam=null},onQuickParams:function(){this.show=!1,this.searchValue=this.currentHistroyParam.sn,this.filterValue=this.currentHistroyParam.condition,this.iotData=this.currentHistroyParam.iotData,this.begin=this.currentHistroyParam.begin,this.end=this.currentHistroyParam.end,this.fastTime=this.currentHistroyParam.fastTime,this.dataType=this.currentHistroyParam.dataType},onCurrentSearchHistroyDelete:function(){var t=this;this.show=!1,this.searchRecords.some((function(e,i){e.sn===t.currentHistroyParam.sn&&t.searchRecords.splice(i,1)})),this.$ls.set("searchRecords",this.searchRecords)},onSearchHistroyAllDelete:function(){this.show=!1,this.$ls.remove("searchRecords"),this.searchRecords=[]},onConfirm:function(t,e){this.fastTime="5";var i=l()(e).format("YYYY-MM-DD HH:mm");0==t?this.begin=i:this.end=i,this.showPicker=!1},onClearAllCacheDialog:function(t){var e=this;this.$dialog.confirm({message:"确定要删除全部历史记录?"}).then((function(){"search"==t?(e.$ls.remove("searchHistory"),e.searchHistory=[]):(e.$ls.remove("filterHistory"),e.filterHistory=[])})).catch((function(){}))},onFastTimeChange:function(){var t=this.fastTime;switch(t){case"1":this.begin=l()().startOf("day").format("YYYY-MM-DD HH:mm"),this.end=l()().format("YYYY-MM-DD HH:mm");break;case"2":this.begin=l()().subtract(2,"days").format("YYYY-MM-DD HH:mm"),this.end=l()().format("YYYY-MM-DD HH:mm");break;case"3":this.begin=l()().subtract(3,"days").format("YYYY-MM-DD HH:mm"),this.end=l()().format("YYYY-MM-DD HH:mm");break;case"4":this.begin=l()().subtract(7,"days").format("YYYY-MM-DD HH:mm"),this.end=l()().format("YYYY-MM-DD HH:mm");break;case"5":break;default:break}},setInputText:function(t,e){0==t?(this.searchValue=e,this.searchShow=!1):(this.filterValue=e,this.filterShow=!1)},onLoad:function(){var t=this;setTimeout((function(){t.loading=!1,t.finished=!0}),1e3)}}},h=c,u=i(1001),d=(0,u.Z)(h,a,s,!1,null,"7f4c7332",null),f=d.exports}}]);